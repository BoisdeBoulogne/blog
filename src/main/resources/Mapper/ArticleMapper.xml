<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.blog.Mapper.ArticleMapper">
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO articles (user_id, create_time, update_time, views, content, title,author)
        VALUES (#{userId}, #{createTime}, #{updateTime}, #{views}, #{content}, #{title},#{author})
    </insert>
    <select id="getUsefulById" resultType="com.example.blog.Pojo.entity.Article">
        select * from articles where user_id = #{userId}
    </select>
    <update id="update">
        update articles
        <set>
            <if test="title != null and title != ''">
                title = #{title},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="content != null">
                content = #{content},
            </if>
            <if test="views != null">
                views = #{views},
            </if>
            <if test="likes != null">
                likes = #{likes},
            </if>
            <if test="collects != null">
                collects = #{collects}
            </if>
        </set>
        where id = #{id}
    </update>



    <update id="likeOrCollect">
        update articles
        <set>
            <if test="collects == 1">
                collects = collects + #{howMany}
            </if>
            <if test="collects == 0">
                likes = likes + #{howMany}
            </if>
        </set>
        where id = #{articleId}
    </update>

    <select id="forHomePage">
        select id from articles
        order by views + likes * 3 + collects *5
    </select>

</mapper>
